name: ROUP CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    name: Build
    strategy:
      matrix:
      # Version should be guarded with quotes (1.80 -> "1.80"). Otherwise, 1.80 may be recognized as 1.8, which is a much older version.
        version: ["1.82", "1.81", "1.80", "1.79", "1.78", "1.77"]
        os: [ubuntu-24.04, windows-2022, macos-15]
        llvm: ["18"]

    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4

      # Check supported versions at: https://github.com/KyleMayes/install-llvm-action/blob/master/assets.json
      - name: Set up LLVM on Windows and macOS
        if: ${{ matrix.os != 'ubuntu-24.04' }}
        uses: KyleMayes/install-llvm-action@v2
        with:
          version: "{{ matrix.llvm }}"

      - name: Set up LLVM on on Ubuntu
        if: ${{ matrix.os == 'ubuntu-24.04' }}
        run: |
          sudo add-apt-repository -y 'deb http://apt.llvm.org/noble/ llvm-toolchain-noble-${{ matrix.llvm }} main'
          sudo apt-get update
          sudo apt-get install -y \
            clang-${{ matrix.llvm }}

      - uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: ${{ matrix.version }}
          components: rustfmt

      - name: Check rust information
        run: |
          rustc --version
          cargo --version

      - name: Check llvm information
        run: |
          clang --version
          clang++ -v
