<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Minimal Unsafe C API for OpenMP Parser"><title>roup::c_api - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-aa0817cf.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="roup" data-themes="" data-resource-suffix="" data-rustdoc-version="1.90.0 (1159e78c4 2025-09-14)" data-channel="1.90.0" data-search-js="search-fa3e91e5.js" data-settings-js="settings-5514c975.js" ><script src="../../static.files/storage-68b7e25d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-eebb9057.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../roup/index.html">roup</a><span class="version">0.3.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module c_api</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#minimal-unsafe-c-api-for-openmp-parser" title="Minimal Unsafe C API for OpenMP Parser">Minimal Unsafe C API for OpenMP Parser</a><ul><li><a href="#design-philosophy-direct-pointers-vs-handles" title="Design Philosophy: Direct Pointers vs Handles">Design Philosophy: Direct Pointers vs Handles</a></li><li><a href="#safety-analysis-18-unsafe-blocks-60-lines" title="Safety Analysis: 18 Unsafe Blocks (~60 lines)">Safety Analysis: 18 Unsafe Blocks (~60 lines)</a></li><li><a href="#case-insensitive-matching-string-allocation-tradeoff" title="Case-Insensitive Matching: String Allocation Tradeoff">Case-Insensitive Matching: String Allocation Tradeoff</a></li><li><a href="#learning-rust-why-unsafe-is-needed-at-ffi-boundary" title="Learning Rust: Why Unsafe is Needed at FFI Boundary">Learning Rust: Why Unsafe is Needed at FFI Boundary</a></li><li><a href="#c-caller-responsibilities" title="C Caller Responsibilities">C Caller Responsibilities</a></li></ul></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate roup</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">roup</a></div><h1>Module <span>c_api</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/roup/c_api.rs.html#1-1347">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="minimal-unsafe-c-api-for-openmp-parser"><a class="doc-anchor" href="#minimal-unsafe-c-api-for-openmp-parser">§</a>Minimal Unsafe C API for OpenMP Parser</h2>
<p>This module provides a direct pointer-based C FFI with minimal unsafe code.</p>
<h3 id="design-philosophy-direct-pointers-vs-handles"><a class="doc-anchor" href="#design-philosophy-direct-pointers-vs-handles">§</a>Design Philosophy: Direct Pointers vs Handles</h3>
<p>We use <strong>raw C pointers</strong> to Rust structs instead of opaque handles for:</p>
<ul>
<li><strong>Idiomatic C API</strong>: Standard malloc/free pattern familiar to C programmers</li>
<li><strong>Simple memory model</strong>: No global registry, no handle bookkeeping</li>
<li><strong>Easy integration</strong>: Works naturally with C/C++ code</li>
<li><strong>Minimal code</strong>: 632 lines vs 4000+ lines of handle management</li>
</ul>
<h3 id="safety-analysis-18-unsafe-blocks-60-lines"><a class="doc-anchor" href="#safety-analysis-18-unsafe-blocks-60-lines">§</a>Safety Analysis: 18 Unsafe Blocks (~60 lines)</h3>
<p>All unsafe blocks are:</p>
<ul>
<li><strong>NULL-checked</strong> before dereferencing</li>
<li><strong>Documented</strong> with explicit safety requirements</li>
<li><strong>Isolated</strong> only at FFI boundary, never in business logic</li>
<li><strong>Auditable</strong>: ~0.9% of file (60 unsafe lines / 632 total)</li>
</ul>
<h3 id="case-insensitive-matching-string-allocation-tradeoff"><a class="doc-anchor" href="#case-insensitive-matching-string-allocation-tradeoff">§</a>Case-Insensitive Matching: String Allocation Tradeoff</h3>
<p>Functions <code>directive_name_to_kind()</code> and <code>convert_clause()</code> allocate a String
for case-insensitive matching (Fortran uses uppercase, C uses lowercase).</p>
<p><strong>Why not optimize with <code>eq_ignore_ascii_case()</code>?</strong></p>
<ul>
<li>Constants generator (<code>src/constants_gen.rs</code>) requires <code>match</code> expressions</li>
<li>Parser uses syn crate to extract directive/clause mappings from AST</li>
<li>Cannot parse if-else chains → must use <code>match normalized_name.as_str()</code></li>
<li>String allocation is necessary for match arm patterns</li>
</ul>
<p><strong>Is this a performance issue?</strong></p>
<ul>
<li>No: These functions are called once per directive/clause at API boundary</li>
<li>Typical usage: Parse a few dozen directives in an entire program</li>
<li>String allocation cost is negligible compared to parsing overhead</li>
</ul>
<p><strong>Future optimization path</strong>: Update <code>constants_gen.rs</code> to parse if-else chains,
then use <code>eq_ignore_ascii_case()</code> without allocations.</p>
<h3 id="learning-rust-why-unsafe-is-needed-at-ffi-boundary"><a class="doc-anchor" href="#learning-rust-why-unsafe-is-needed-at-ffi-boundary">§</a>Learning Rust: Why Unsafe is Needed at FFI Boundary</h3>
<ol>
<li><strong>C strings</strong> → Rust strings: <code>CStr::from_ptr()</code> requires unsafe</li>
<li><strong>Memory ownership</strong> transfer: <code>Box::into_raw()</code> / <code>Box::from_raw()</code></li>
<li><strong>Raw pointer dereferencing</strong>: C passes pointers, we must dereference</li>
</ol>
<p>Safe Rust cannot verify C’s guarantees, so we explicitly document them.</p>
<h3 id="c-caller-responsibilities"><a class="doc-anchor" href="#c-caller-responsibilities">§</a>C Caller Responsibilities</h3>
<p>C callers MUST:</p>
<ul>
<li>✅ Check for NULL returns before use</li>
<li>✅ Call <code>_free()</code> functions to prevent memory leaks</li>
<li>✅ Never use pointers after calling <code>_free()</code></li>
<li>✅ Pass only valid null-terminated strings</li>
<li>✅ Not modify strings returned by this API</li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.OmpClause.html" title="struct roup::c_api::OmpClause">OmpClause</a></dt><dd>Opaque clause type (C-compatible)</dd><dt><a class="struct" href="struct.OmpClauseIterator.html" title="struct roup::c_api::OmpClauseIterator">OmpClause<wbr>Iterator</a></dt><dd>Iterator over clauses</dd><dt><a class="struct" href="struct.OmpDirective.html" title="struct roup::c_api::OmpDirective">OmpDirective</a></dt><dd>Opaque directive type (C-compatible)</dd><dt><a class="struct" href="struct.OmpStringList.html" title="struct roup::c_api::OmpStringList">OmpString<wbr>List</a></dt><dd>List of strings (for variable names in clauses)</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.ROUP_LANG_C.html" title="constant roup::c_api::ROUP_LANG_C">ROUP_<wbr>LANG_<wbr>C</a></dt><dd>C language (default) - uses #pragma omp</dd><dt><a class="constant" href="constant.ROUP_LANG_FORTRAN_FIXED.html" title="constant roup::c_api::ROUP_LANG_FORTRAN_FIXED">ROUP_<wbr>LANG_<wbr>FORTRAN_<wbr>FIXED</a></dt><dd>Fortran fixed-form - uses !$OMP or C$OMP in columns 1-6</dd><dt><a class="constant" href="constant.ROUP_LANG_FORTRAN_FREE.html" title="constant roup::c_api::ROUP_LANG_FORTRAN_FREE">ROUP_<wbr>LANG_<wbr>FORTRAN_<wbr>FREE</a></dt><dd>Fortran free-form - uses !$OMP sentinel</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.roup_clause_default_data_sharing.html" title="fn roup::c_api::roup_clause_default_data_sharing">roup_<wbr>clause_<wbr>default_<wbr>data_<wbr>sharing</a></dt><dd>Get default data sharing from default clause.</dd><dt><a class="fn" href="fn.roup_clause_free.html" title="fn roup::c_api::roup_clause_free">roup_<wbr>clause_<wbr>free</a></dt><dd>Free a clause.</dd><dt><a class="fn" href="fn.roup_clause_iterator_free.html" title="fn roup::c_api::roup_clause_iterator_free">roup_<wbr>clause_<wbr>iterator_<wbr>free</a></dt><dd>Free clause iterator.</dd><dt><a class="fn" href="fn.roup_clause_iterator_next.html" title="fn roup::c_api::roup_clause_iterator_next">roup_<wbr>clause_<wbr>iterator_<wbr>next</a></dt><dd>Get next clause from iterator.</dd><dt><a class="fn" href="fn.roup_clause_kind.html" title="fn roup::c_api::roup_clause_kind">roup_<wbr>clause_<wbr>kind</a></dt><dd>Get clause kind.</dd><dt><a class="fn" href="fn.roup_clause_reduction_operator.html" title="fn roup::c_api::roup_clause_reduction_operator">roup_<wbr>clause_<wbr>reduction_<wbr>operator</a></dt><dd>Get reduction operator from reduction clause.</dd><dt><a class="fn" href="fn.roup_clause_schedule_kind.html" title="fn roup::c_api::roup_clause_schedule_kind">roup_<wbr>clause_<wbr>schedule_<wbr>kind</a></dt><dd>Get schedule kind from schedule clause.</dd><dt><a class="fn" href="fn.roup_clause_variables.html" title="fn roup::c_api::roup_clause_variables">roup_<wbr>clause_<wbr>variables</a></dt><dd>Get variable list from clause (private, shared, reduction, etc.).</dd><dt><a class="fn" href="fn.roup_directive_clause_count.html" title="fn roup::c_api::roup_directive_clause_count">roup_<wbr>directive_<wbr>clause_<wbr>count</a></dt><dd>Get number of clauses in a directive.</dd><dt><a class="fn" href="fn.roup_directive_clauses_iter.html" title="fn roup::c_api::roup_directive_clauses_iter">roup_<wbr>directive_<wbr>clauses_<wbr>iter</a></dt><dd>Create an iterator over directive clauses.</dd><dt><a class="fn" href="fn.roup_directive_free.html" title="fn roup::c_api::roup_directive_free">roup_<wbr>directive_<wbr>free</a></dt><dd>Free a directive allocated by <code>roup_parse()</code>.</dd><dt><a class="fn" href="fn.roup_directive_kind.html" title="fn roup::c_api::roup_directive_kind">roup_<wbr>directive_<wbr>kind</a></dt><dd>Get directive kind.</dd><dt><a class="fn" href="fn.roup_directive_name.html" title="fn roup::c_api::roup_directive_name">roup_<wbr>directive_<wbr>name</a></dt><dd>Get directive name as a C string.</dd><dt><a class="fn" href="fn.roup_parse.html" title="fn roup::c_api::roup_parse">roup_<wbr>parse</a></dt><dd>Parse an OpenMP directive from a C string.</dd><dt><a class="fn" href="fn.roup_parse_with_language.html" title="fn roup::c_api::roup_parse_with_language">roup_<wbr>parse_<wbr>with_<wbr>language</a></dt><dd>Parse an OpenMP directive with explicit language specification.</dd><dt><a class="fn" href="fn.roup_string_list_free.html" title="fn roup::c_api::roup_string_list_free">roup_<wbr>string_<wbr>list_<wbr>free</a></dt><dd>Free string list.</dd><dt><a class="fn" href="fn.roup_string_list_get.html" title="fn roup::c_api::roup_string_list_get">roup_<wbr>string_<wbr>list_<wbr>get</a></dt><dd>Get string at index from list.</dd><dt><a class="fn" href="fn.roup_string_list_len.html" title="fn roup::c_api::roup_string_list_len">roup_<wbr>string_<wbr>list_<wbr>len</a></dt><dd>Get length of string list.</dd></dl></section></div></main></body></html>